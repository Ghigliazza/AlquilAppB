<%
@driver = params[:driver]

%>

<%= form_with(model: rental) do |form| %>
  <% if rental.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(rental.errors.count, "error") %> prohibited this rental from being saved:</h2>
      
      <ul>
        <% rental.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <label for="hsRange" class="form-label">Indique la cantidad de horas: </label> 
    <input type="range" id="hsRange" value="1" min=1 max=24 step="1" oninput="this.nextElementSibling.value = this.value" onchange="calcule_rent()">
    <output> 1 </output>
  </div>

  <div>
    <%= form.label :price, style: "display: block" %>
    <%= form.hidden_field :price, :id => "in_price", :value => Rental.states["#{@rental.state}"] %>
    <output id="out_price"><%= Rental.states["#{@rental.state}"] %> </output>
  </div>

  <div>
    Saldo: <%= current_user.balance %>

    <%#BORRAR%>
    <!--
    Usuario: <%#= current_user.name%>
    ID: <%#= current_user.id%>
    <%#= car_id %>
    -->
  </div>

  <div>
    <%= form.label :expires, style: "display: block" %>
    <%= form.hidden_field :expires, :id => "in_expire", :value => Time.now + 1.hour %>
    <output id="out_expired"><%= (Time.now + 1.hour).strftime('%Y-%m-%e %k:%M:%S') %></output>
  </div>

  <div>
    <%= form.hidden_field :user_id, :value => current_user.id %>
  </div>

  <div>
    <%= form.hidden_field :car_id, :value => params[:car_id]%>
  </div>

  <div>
    <%= form.submit %>
  </div>
<% end %>

<%= params[:id] %>

<script>
  function calcule_rent() {
    const in_price = $('#in_price')
    const out_price = $('#out_price')
    const in_expire = $('#in_expire')
    const out_expired = $('#out_expired')
    const hs = $('#hsRange').val()  

    in_price.val(hs * <%= Rental.states["#{@rental.state}"] %>)
    out_price.val(in_price.val())

    date = new Date().getTime() + hs*60*60*1000 //1hs->60m, 1m->60s, 1s->1000ms
    date = new Date(date)

    in_expire.val(date_format(date))
    out_expired.val(in_expire.val())
  }

  function date_format(date) {
    return `${date.getFullYear()}-${date.getMonth()+1}-${[date.getDate()]} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`
  }

</script>
